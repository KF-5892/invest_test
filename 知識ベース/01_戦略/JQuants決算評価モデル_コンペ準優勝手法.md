# JQuants APIを用いた決算評価モデル（コンペ準優勝手法）

**出典**: [JQuants APIを用いて日本最大の株式分析コンペで準優勝した決算評価モデルを動かす方法](https://zenn.dev/gamella/articles/bdd980d4929a90)
**著者**: gamella（北山智也） — AlpacaTech Solutions Business Manager / マケデコ運営
**関連イベント**: マケデコ キックオフイベント
**追加日**: 2026-03-01

---

## コンペティション概要

- **主催**: JPX（日本取引所グループ）— 日本最大の株式分析コンペティション
- **タスク**: 東証上場企業の決算短信発表後、**20営業日以内の最高値・最安値**を予測
- **評価指標**: 予測と実値の**順位相関係数（スピアマン相関）**
- **成績**: 第1回（バックテスト評価）・第2回（ライブフォワードテスト）ともに**準優勝**
  - フォワードテストでも性能維持 → **汎化性能が実証済み**

## モデル設計の核心

### 予測対象の工夫（過学習回避）

- リターンそのものを直接予測するのは**過学習しやすい**
  - 学習期間と予測期間の環境変化に弱くなる
- **別のプロキシーを使うアプローチ**が有効
  - 本モデルでは高値・安値の順位相関を予測対象とする
  - 2020年末までの学習モデルを2021年の決算に適用しても、**平均順位相関0.44を維持**

> **教訓**: リターン直接予測 → 過学習リスク大。プロキシー変数の設計が汎化性能の鍵。

### 特徴量設計

#### 定常性の重視
- 株価そのもの（非定常）ではなく、**階差系列（リターン）を特徴量**として使用
- 機械学習モデルでは学習データとテストデータで特徴量分布が似ていること（定常性）が必須

#### 時間窓とデータ
- **過去60営業日**のデータから特徴量を生成
- 予測対象日からバッファ含めて**土日除く過去90日**まで遡って生成
- ルックアヘッドバイアスに注意（本プロジェクトのCLAUDE.md規約と合致）

#### ドメイン知識の重要性
- 「生データをモデルに与えて関係性を発見する手法」vs「ドメイン知識で特徴量を設計する手法」
- **金融に精通しているほど効果的なモデルが構築できる**
- 本プロジェクトの方針「特徴量エンジニアリング > 複雑なモデル構造」と完全に一致

### 欠損値処理
- 多くのMLモデルは欠損値をそのまま扱えない
- 補完方法: 平均値埋め、リストワイズ法、多重代入法など
- J-Quants APIデータでも欠損値は発生するため、前処理パイプラインに組み込む必要あり

### 特徴量重要度の活用

- 「ファイナンス機械学習」（de Prado）の知見:
  - **MLモデルそのものよりも、特徴量重要度を元に戦略や理論を立てるべき**
  - 異常なアノマリーは高い特徴量重要度として検出される
- 解釈可能性とアルファ発見の両立

## 本プロジェクトへの適用ポイント

### 直接活用できる知見

1. **予測対象の設計**: リターン直接予測を避け、順位相関やプロキシー変数を使用
2. **特徴量の定常性**: リターンベースの特徴量設計を徹底
3. **60営業日窓**: 特徴量生成の標準的な時間窓として参考
4. **特徴量重要度駆動**: モデル精度よりも特徴量重要度からアルファを発見するアプローチ

### AlphaMinerとの連携可能性

- 現在のAlphaMinerは**Fama-French 48業種ポートフォリオ**で戦略評価
- 決算イベント駆動の戦略クラスを追加し、BaseAlpha継承で統合可能
- J-Quants APIの決算データ（`/fins/statements`）と株価データを組み合わせた戦略

### 注意点

- コンペのタスク（20営業日の高値安値予測）と実運用のタスクは異なる場合がある
- 順位相関が高い ≠ 収益性が高い（実運用ではポジションサイジングやリスク管理が別途必要）
- J-Quants APIのプラン制約を確認すること（決算データの取得可能範囲）

## 参考リンク

- [J-Quants API ドキュメント](https://jpx-jquants.com/apidoc.html)
- [株式分析チュートリアル | 日本取引所グループ](https://japanexchangegroup.github.io/J-Quants-Tutorial/)
- [AlpacaDB/jquants-api-sample (GitHub)](https://github.com/AlpacaDB/jquants-api-sample)
