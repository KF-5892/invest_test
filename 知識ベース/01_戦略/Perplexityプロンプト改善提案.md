# Perplexity 日次調査プロンプト 改善提案

作成日: 2026-02-26
対象: 毎日実行している知見収集プロンプト（v1）

---

## 判定: 改善が必要（5つの構造的問題あり）

---

## 問題1: 「過去の調査結果を参照」が実質機能していない

**現状:**
プロンプトに「過去の調査結果も参照し」と書いているが、Perplexityは毎回新規セッションで起動するため実際には参照できない。2/14の結果と2/25の結果を比べると「AIエージェント量産」「DRL進化」「モメンタム」という同じトレンドが繰り返されており、差分が見えない。

**改善案:**
前回結果のサマリー（既知の戦略リスト）をプロンプト冒頭に渡し、「以下の内容は把握済みです。**新しい情報のみ**を提供してください」と明示する。

---

## 問題2: バックテストコードの品質指定がない

**現状:**
「コードをpythonで作成してください」だけでは品質が不定。2/25の結果コードには以下の欠陥がある:
- `for` ループによる非効率な実装（pandasベクタライズ未使用）
- `days_held = 1` と固定されており、ストップロス判定ロジックが実質機能していない
- 取引コスト・スリッページ未考慮
- ウォークフォワード検証なし
- DRLコードは概念のみで実行不可能

既に `実装/バックテスト/japan_trading_backtest_2026.py` に3戦略が実装済みのため、毎回同品質の初歩的なコードを生成しても活用しにくい。

**改善案:**
- 「既存の戦略は除外し、**新規戦略**のコードのみ作成」と指定
- 品質要件を明記: pandasベクタライズ処理・取引コスト考慮・ウォークフォワード検証付き

---

## 問題3: プロジェクトの弱点に対応した知見が収集されていない

**現状:**
知識ベース評価で判明した不足領域がプロンプトに反映されていない:
- リスク管理・ポジションサイジング（知識ベースに未整備）
- 取引コスト・スリッページのモデリング
- 日本市場固有の制約（制度信用・一般信用、空売り規制）
- J-Quants APIを使った具体的な実装手法
- サバイバーシップバイアス・ルックアヘッドバイアス対策

**改善案:**
「今回の重点調査テーマ」セクションを追加し、週次でテーマを変える。

---

## 問題4: YouTubeソースの現実性

**現状:**
「YouTube(字幕から取得)」とあるが、Perplexityがリアルタイムで字幕を抽出する能力は限られている。2/25結果でも「UKI: AlphaMiner」「マケデコ: MixSeek-Bulk-Algos」という情報はYouTube直接解析ではなく、Speaker DeckやZennの二次ソースから取得している。

**改善案:**
- YouTube字幕への依存を減らし、確実にアクセスできるソースを明示: マケデコのSpeaker Deck・Zenn、UKIのnote・Qiita
- 「直近1ヶ月以内の情報に限定」を追加し、古い情報の再掲を防ぐ

---

## 問題5: 結果が広すぎて次のアクションが不明確

**現状:**
2/25結果には「フェーズ1〜4の実用化ステップ」が書かれているが、プロジェクト固有の状況（既存コード・J-Quants情報）を考慮していないため、そのまま使えない。

**改善案:**
プロンプト末尾に「個人投資家が今週中に試せる具体的なアクションを1〜3個だけ列挙してください」を追加。

---

## 改善後プロンプト（v2）

```
# 日本のシステムトレード戦略 調査プロンプト v2

## 調査依頼
日本のシステムトレードなど、投資や金融における戦略についての**直近1ヶ月以内の新しい情報**を調査してください。

## 情報ソース（優先度順）
1. マケデコの発信（Speaker Deck、Zenn記事、YouTube概要欄）
2. UKIの発信（note、Qiita、Xポスト）
3. あばねちゃんの発信（YouTube概要欄、Xポスト）
4. 金融系論文（arXiv、SSRN）- 日本語・英語
5. GitHubの定量投資関連リポジトリ（スター増加順）
6. Xポスト（ハッシュタグ: #システムトレード #クオンツ #J-Quants）

## 既に把握済みの情報（この内容は省略してください）
- AIエージェントによる戦略量産（マケデコ「投資戦略を量産せよ2」）
- xLSTM・PPO・A2Cによる深層強化学習戦略
- モメンタム戦略（短期/中期）
- ペアトレード・統計的アービトラージ
- 移動平均クロス戦略
- J-Quants APIの基本的な使い方
- 立花証券e支店API・カブコム証券APIの認証方法

## 今回の重点調査テーマ
以下のテーマを優先的に調査してください:
- **リスク管理・ポジションサイジング**: Kelly基準、固定比率法、日本株での実例
- **取引コストのモデリング**: スリッページ、証券会社手数料、借株コスト
- **バックテストの落とし穴**: サバイバーシップバイアス、ルックアヘッドバイアスの回避手法

## 考察依頼
- 上記の新しい情報から傾向・考察を述べてください
- 過去（2020〜2025年）からの変化点を簡潔に示してください

## 戦略アイデア
新規で有効と思われる戦略を1〜2個提案してください（既存戦略の改良は除く）

## コード要件（新規戦略にのみ作成）
以下の要件を満たすPythonコードを作成してください:
- pandas/numpyのベクタライズ処理を使用（forループ禁止）
- 取引コスト：往復0.1%（証券手数料+スリッページ）を考慮
- ウォークフォワード検証を含める（訓練期間2年、検証期間6ヶ月）
- 評価指標：シャープレシオ、カルマーレシオ、最大ドローダウン

## アクション提示
最後に、個人投資家が**今週中に試せる具体的なアクション**を1〜3個だけ列挙してください
```

---

## 変更点サマリー

| 項目 | 変更前（v1） | 変更後（v2） |
|------|------------|------------|
| 差分管理 | 毎回同じ調査（差分なし） | 「既把握情報」を除外指定 |
| 情報ソース | YouTubeの字幕（取得困難） | Speaker Deck・Zenn・note等の確実なソース |
| 重点テーマ | 固定なし（広範すぎ） | 週次テーマ設定（初回: リスク管理・取引コスト） |
| コード品質 | 指定なし → 低品質になりがち | ベクタライズ・コスト考慮・WFO必須 |
| 期間フィルタ | なし → 古い情報が混在 | 直近1ヶ月以内に限定 |
| アクション | なし（汎用的なフェーズ説明のみ） | 今週試せる具体的アクション1〜3個 |

---

## 重点テーマのローテーション案（週次）

| 週 | テーマ |
|----|--------|
| 第1週 | リスク管理・ポジションサイジング |
| 第2週 | 日本市場固有の制約（信用取引・空売り規制・決算シーズン） |
| 第3週 | データ品質・サバイバーシップバイアス対策 |
| 第4週 | インフラ・実行環境の最新動向 |

毎月のサイクルで回すことで、知識ベースの各カテゴリ（01〜04）をバランスよく強化できる。

---

## 検証方法

改善後プロンプトで1週間運用し、以下を確認:
- 既知情報の再掲が減ったか（差分の有無）
- コードが取引コスト考慮・ウォークフォワード検証付きで生成されるか
- リスク管理・コスト関連の知見が `知識ベース/` に追加されているか
